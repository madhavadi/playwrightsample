<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Automation Summary Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f6f8; color: #222; }
    header { background: #0b5cff; color: #fff; padding: 18px 24px; }
    .container { padding: 20px; max-width: 1200px; margin: 0 auto; }
    .card { background: #fff; border-radius: 8px; padding: 16px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); }
    .grid { display:grid; grid-template-columns: repeat(3, 1fr); gap:16px; margin-bottom:16px; }
    .full { grid-column: 1 / -1; }
    h2 { margin:0 0 12px 0; font-size:18px; }
    canvas { width:100% !important; height: 260px !important; }
    table { width:100%; border-collapse:collapse; margin-top:8px; }
    th, td { text-align:left; padding:8px; border-bottom:1px solid #eee; font-size:13px; }
    footer { text-align:center; padding:14px; color:#666; font-size:13px; }
    @media (max-width:900px){ .grid{ grid-template-columns: 1fr; } }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <div class="container">
      <h1 style="margin:0; font-size:20px;">Automation Summary Interactive Dashboard</h1>
      <div style="font-size:13px; opacity:0.9;">Execution Trends, Distribution & CI/CD History</div>
    </div>
  </header>

  <div class="container">
    <div class="card">
      
      <div class="grid">
        <div class="card">
          <h2>Execution Trend (Last 6 Weeks)</h2>
          <canvas id="trendChart"></canvas>
        </div>

        <div class="card">
          <h2>Test Distribution by Channel</h2>
          <canvas id="doughnutChart"></canvas>
        </div>
        
        <div class="card full">
          <h2>Recent Runs & CI/CD Status</h2>
          <table id="runsTable">
            <thead><tr><th>Run ID</th><th>Date</th><th>Channel</th><th>Env</th><th>Status</th><th>Passed</th><th>Failed</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="card">
          <h2>Top 5 Failing Tests</h2>
          <table id="failTable">
            <thead><tr><th>Test Case</th><th>Channel</th><th>Last Failure</th><th>Fail Count</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        </div>

    </div> <footer>Interactive HTML Dashboard â€” exportable, self-contained. Replace sample data with your real CI artifacts / test reports.</footer>
  </div>

<script>

let sampleData = {}; 



fetch('./dashboard-data.json') 
  .then(response => response.json()) 
  .then(data => {
   
    sampleData = data; 
    
    
    createCharts();
    populateRunsTable(sampleData.runs);
    populateFailTable(sampleData.failures);
  })
  .catch(error => console.error('Error fetching dashboard data:', error));

// --- Runs table ---
function populateRunsTable(runs) {
  const tbody = document.querySelector('#runsTable tbody');
  tbody.innerHTML = '';
  runs.slice(0,20).forEach(r=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.id}</td><td>${r.date}</td><td>${r.channel}</td><td>${r.env}</td><td>${r.status}</td><td>${r.passed}</td><td>${r.failed}</td>`;
    tbody.appendChild(tr);
  });
}


function populateFailTable(items) {
  const tbody = document.querySelector('#failTable tbody');
  tbody.innerHTML = '';
  items.forEach(it=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${it.test}</td><td>${it.channel}</td><td>${it.last}</td><td>${it.count}</td>`;
    tbody.appendChild(tr);
  });
}

// --- Charts ---
let trendChart, doughnutChart; 

function createCharts() {
  const tctx = document.getElementById('trendChart').getContext('2d');
  trendChart = new Chart(tctx, {
    type: 'line',
    data: {
      labels: sampleData.trend.weeks,
      datasets: [
        {label:'Executed', data: sampleData.trend.executed, fill:false, tension:0.3},
        {label:'Passed', data: sampleData.trend.passed, fill:true, tension:0.3, backgroundColor: 'rgba(11,92,255,0.08)'}
      ]
    },
    options: { responsive:true, plugins:{legend:{position:'top'}}}
  });

  const dctx = document.getElementById('doughnutChart').getContext('2d');
  doughnutChart = new Chart(dctx, {
    type: 'doughnut',
    data: { labels: Object.keys(sampleData.distribution), datasets: [{ data: Object.values(sampleData.distribution)}] },
    options: { responsive:true }
  });
  
 
}

createCharts();
populateRunsTable(sampleData.runs);
populateFailTable(sampleData.failures);



</script>
</body>
</html>